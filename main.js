(()=>{"use strict";const e=new XMLHttpRequest;function t(e){return e<10?String(0)+String(e):e}class n{constructor(){this.title,this.height="2.1vw"}centralBlock(t,s){this.title=t||"Удалить тикет";let i=document.createElement("div");i.classList.add("show-message");let c=document.createElement("div");c.classList.add("show-message__title"),c.innerText=this.title,i.append(c);let a=document.createElement("div");if(a.classList.add("show-message__title-preview"),"Удалить тикет"!==this.title){a.innerText="Краткое описание";var o=document.createElement("input");o.classList.add("show-message__preview");let e=document.createElement("div");e.classList.add("show-message__title-description"),e.innerText="Подробное описание";var d=document.createElement("textarea");d.classList.add("show-message__description"),i.append(a),i.append(o),i.append(e),i.append(d)}else a.innerText="Вы уверены, что хотите удалить тикет? Это действие необратимо",i.append(a),i.style.height="8vw";let l=document.createElement("button");l.classList.add("show-message__But-remov"),l.innerText="Отмена",l.addEventListener("click",(()=>{i.remove(),n.remov()}));let r=document.createElement("button");return r.classList.add("show-message__But-ok"),r.innerText="Ok",r.addEventListener("click",(()=>{"Добавить тикет"==this.title&&function(t,n){let s={id:null,name:t,description:n,status:!1,created:null},i=JSON.stringify(s);e.open("POST","http://localhost:7070/?method=createTicket"),e.setRequestHeader("Content-Type","application/json"),e.send(i),console.log(i),location.reload()}(o.value,d.value),"Изменить тикет"==this.title&&function(t,n,s){let i={name:n,description:s},c=JSON.stringify(i);e.open("POST","http://localhost:7070/?method=updateById&id="+t),e.setRequestHeader("Content-Type","application/json"),e.send(c),console.log(e.response),location.reload()}(s,o.value,d.value),"Удалить тикет"==this.title&&function(t){e.open("GET","http://localhost:7070/?method=deleteById&id="+t),e.send(),location.reload()}(s)})),i.append(l),i.append(r),i}static remov(){document.querySelector(".messages-box").classList.add("visually-hidden")}}const s=document.querySelector(".messages-box"),i=document.querySelector(".box__addBut"),c=document.querySelector(".box"),a=new n;window.addEventListener("load",(()=>{!function(){let n;e.open("GET","http://localhost:7070/?method=allTickets"),e.send(),e.addEventListener("load",(()=>{n=function(){if(e.status>=200&&e.status<300)try{return JSON.parse(e.responseText)}catch(e){console.error(e)}}(),console.log(n),n.forEach((e=>{let n=new Date(e.created),s=t(n.getUTCDate())+"."+t(n.getUTCMonth()+1)+"."+function(e){let t=Array.from(String(e));return String(t[2])+String(t[3])}(n.getUTCFullYear())+" "+t(n.getUTCHours())+":"+t(n.getUTCMinutes());!function(e,t,n,s=!1,i){const c=document.querySelector(".boxF"),a=document.createElement("div");a.classList.add("box__ticket");const o=document.createElement("div");o.classList.add("box__ticket__id"),o.innerText=e;const d=document.createElement("label");d.classList.add("checker");const l=document.createElement("input");l.type="checkbox",l.classList.add("box__ticket__checkbox"),l.checked=s;const r=document.createElement("div");r.classList.add("box__ticket__checker");const _=document.createElement("div");_.classList.add("box__ticket__text"),_.innerText=t;const p=document.createElement("div");p.classList.add("box__ticket__time"),p.innerText=n;const u=document.createElement("div");u.classList.add("box__ticket__editor");const m=document.createElement("div");m.classList.add("box__ticket__delete");const h=document.createElement("div");h.classList.add("box__ticket__description"),h.classList.add("visually-hidden"),h.innerText=i,d.appendChild(l),d.appendChild(r),a.appendChild(o),a.appendChild(d),a.appendChild(_),a.appendChild(p),a.appendChild(u),a.appendChild(m),a.appendChild(h),c.appendChild(a)}(e.id,e.name,s,e.status,e.description)}))}))}()})),i.addEventListener("click",(()=>{s.classList.remove("visually-hidden"),s.append(a.centralBlock("Добавить тикет"))})),c.addEventListener("click",(t=>{if(t.target.classList.contains("box__ticket__editor")){s.classList.remove("visually-hidden");let e=t.target.parentElement.querySelector(".box__ticket__id").innerText;s.append(a.centralBlock("Изменить тикет",e))}if(t.target.classList.contains("box__ticket__delete")){s.classList.remove("visually-hidden");let e=t.target.parentElement;s.append(a.centralBlock(void 0,e.querySelector(".box__ticket__id").innerText))}if(t.target.classList.contains("box__ticket__text")&&function(e){const t=e.parentElement.querySelector(".box__ticket__description");t.classList.contains("visually-hidden")?t.classList.remove("visually-hidden"):t.classList.add("visually-hidden")}(t.target),t.target.classList.contains("box__ticket__checker")){let n=t.target.parentElement.querySelector(".box__ticket__checkbox").checked,s=t.target.parentElement.parentElement;console.log(n),console.log(s.querySelector(".box__ticket__id").innerText),function(t,n){let s={status:n};s.status=!n;let i=JSON.stringify(s);e.open("POST","http://localhost:7070/?method=updateById&id="+t),e.setRequestHeader("Content-Type","application/json"),e.send(i),console.log(e.response),location.reload()}(s.querySelector(".box__ticket__id").innerText,n)}}))})();